<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Змійка</title>

<style>
body {
  background:#111;
  color:white;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  height:100vh;
  margin:0;
  font-family:Arial;
}

canvas {
  background:black;
  border:2px solid white;
}

.info {
  margin-top:10px;
}

button {
  margin-top:10px;
  padding:10px 20px;
  font-size:16px;
  background:limegreen;
  border:none;
  cursor:pointer;
  display:none;
}
</style>
</head>

<body>

<canvas id="game" width="400" height="400"></canvas>

<div class="info">
Очки: <span id="score">0</span> |
Рекорд: <span id="highscore">0</span>
</div>

<button id="restart">Спробувати ще</button>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");
const highScoreEl = document.getElementById("highscore");
const restartBtn = document.getElementById("restart");

const gridSize = 20;
const tileCount = canvas.width / gridSize;

let snake;
let direction;
let nextDirection;
let food;
let score;
let highScore;
let speed;
let lastTime = 0;
let gameOver = false;

function resetGame() {
  snake = [{x:10,y:10}];
  direction = {x:0,y:0};
  nextDirection = {x:0,y:0};
  score = 0;
  speed = 8;
  gameOver = false;

  highScore = parseInt(localStorage.getItem("highScore")) || 0;
  highScoreEl.textContent = highScore;
  scoreEl.textContent = score;

  generateFood();
  restartBtn.style.display = "none";
}

function gameLoop(time) {
  if(gameOver) return;

  const delta = time - lastTime;
  if(delta > 1000 / speed) {
    update();
    lastTime = time;
  }

  requestAnimationFrame(gameLoop);
}

function update() {

  direction = nextDirection;

  if(direction.x === 0 && direction.y === 0) {
    draw();
    return;
  }

  const head = {
    x: snake[0].x + direction.x,
    y: snake[0].y + direction.y
  };

  // стіни
  if(head.x < 0 || head.x >= tileCount ||
     head.y < 0 || head.y >= tileCount) {
    return endGame();
  }

  // тіло
  for(let i=0;i<snake.length;i++){
    if(snake[i].x === head.x && snake[i].y === head.y){
      return endGame();
    }
  }

  snake.unshift(head);

  if(head.x === food.x && head.y === food.y){
    score += 10;
    scoreEl.textContent = score;

    if(score > highScore){
      highScore = score;
      localStorage.setItem("highScore", highScore);
      highScoreEl.textContent = highScore;
    }

    generateFood();
  } else {
    snake.pop();
  }

  draw();
}

function draw(){
  ctx.fillStyle = "black";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // їжа
  ctx.fillStyle = "red";
  ctx.fillRect(food.x*gridSize, food.y*gridSize, gridSize-2, gridSize-2);

  // змійка
  for(let i=0;i<snake.length;i++){
    ctx.fillStyle = i===0 ? "lime" : "green";
    ctx.fillRect(snake[i].x*gridSize, snake[i].y*gridSize, gridSize-2, gridSize-2);
  }
}

function generateFood(){
  do{
    food = {
      x: Math.floor(Math.random()*tileCount),
      y: Math.floor(Math.random()*tileCount)
    };
  } while(snake.some(p=>p.x===food.x && p.y===food.y));
}

function endGame(){
  gameOver = true;
  restartBtn.style.display = "block";
}

document.addEventListener("keydown", e=>{
  if(e.key==="ArrowUp" && direction.y!==1)
    nextDirection = {x:0,y:-1};

  if(e.key==="ArrowDown" && direction.y!==-1)
    nextDirection = {x:0,y:1};

  if(e.key==="ArrowLeft" && direction.x!==1)
    nextDirection = {x:-1,y:0};

  if(e.key==="ArrowRight" && direction.x!==-1)
    nextDirection = {x:1,y:0};
});

restartBtn.addEventListener("click", ()=>{
  resetGame();
  requestAnimationFrame(gameLoop);
});

resetGame();
requestAnimationFrame(gameLoop);

</script>

</body>
</html>